name: Create Release

on:
  workflow_dispatch:
    inputs:
      tag:
        description: 'The new version to tag, ex: 1.0.5'
        required: true
        type: string

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Create Release
        run: |
          set -euo pipefail

          git config user.name "myusername"
          git config user.email "myusername@gmail.com"
          echo 1 >> foo.txt
          git add foo.txt
          git commit -m "bump foo.txt"
          git push

          echo "Log level: $TAG"
          COPYFILE_DISABLE=1 tar czvf "apple_support.$TAG.tar.gz" ./*
          ./generate-notes.sh | tee notes.md
          gh release create "$TAG" --notes-file notes.md "apple_support.$TAG.tar.gz"
        env:
          TAG: ${{ inputs.tag }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # - name: Release
      #   uses: softprops/action-gh-release@v1
      #   with:
      #     files: apple_support.${{ inputs.tag }}.tar.gz
      #     body: ${{ inputs.notes }}
      #     tag_name: ${{ inputs.tag }}
      #     fail_on_unmatched_files: true
